<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Register Form -> Dashboard (Bootstrap)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* small visual tweaks */
    body { padding: 1.25rem; }
    .card { box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    @media (min-width: 992px) {
      /* left/right layout on large screens */
      .col-form { border-right: 1px dashed rgba(0,0,0,0.06); }
    }
  </style>
</head>
<body>
<div class="container">
  <h1 class="mb-4">Register & Dashboard</h1>

  <div class="row g-3">
    <!-- Form column -->
    <div class="col-12 col-lg-5 col-form">
      <div class="card p-3">
        <h4 class="card-title">Register</h4>
        <form id="regForm" novalidate>
          <div class="mb-2">
            <label for="name" class="form-label">Full name</label>
            <input type="text" id="name" class="form-control" required>
            <div class="invalid-feedback">Please enter a name.</div>
          </div>

          <div class="mb-2">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-control" required>
            <div class="invalid-feedback">Please enter a valid email.</div>
          </div>

          <div class="mb-2">
            <label for="phone" class="form-label">Phone</label>
            <input type="tel" id="phone" class="form-control" pattern="[0-9\-\+\s]{6,20}">
            <div class="invalid-feedback">Enter a valid phone number (digits, +, -, spaces).</div>
          </div>

          <div class="mb-2">
            <label for="course" class="form-label">Course</label>
            <select id="course" class="form-select">
              <option value="">Choose...</option>
              <option>Computer Science</option>
              <option>Information Technology</option>
              <option>AI & ML</option>
              <option>Data Science</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="notes" class="form-label">Notes</label>
            <textarea id="notes" rows="3" class="form-control"></textarea>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">Register</button>
            <button type="button" id="resetBtn" class="btn btn-outline-secondary">Reset</button>
            <button type="button" id="downloadBtn" class="btn btn-success ms-auto">Export JSON</button>
          </div>

          <div class="mt-2 small text-muted">Data is saved in your browser (localStorage). You can export / import JSON to move data between devices.</div>
        </form>

        <hr>
        <div>
          <label class="form-label">Import JSON file</label>
          <input id="importFile" type="file" accept="application/json" class="form-control">
        </div>

      </div>
    </div>

    <!-- Dashboard column -->
    <div class="col-12 col-lg-7">
      <div class="card p-3">
        <div class="d-flex align-items-center mb-3">
          <h4 class="card-title mb-0">Dashboard</h4>
          <div class="ms-auto">
            <button id="clearAll" class="btn btn-sm btn-outline-danger">Clear All</button>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle" id="entriesTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Course</th>
                <th class="text-truncate">Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="noData" class="text-center text-muted py-3">No registrations yet.</div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Entry</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editForm" novalidate>
          <input type="hidden" id="editId">
          <div class="mb-2">
            <label class="form-label">Full name</label>
            <input id="editName" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Email</label>
            <input id="editEmail" type="email" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Phone</label>
            <input id="editPhone" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Course</label>
            <input id="editCourse" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Notes</label>
            <textarea id="editNotes" class="form-control" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="saveEdit" type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Simple client-only CRUD that persists to localStorage, and allows JSON import/export.
const STORAGE_KEY = 'registrations_v1';
let entries = [];
const regForm = document.getElementById('regForm');
const downloadBtn = document.getElementById('downloadBtn');
const importFile = document.getElementById('importFile');
const entriesTableBody = document.querySelector('#entriesTable tbody');
const noData = document.getElementById('noData');
const editModalEl = document.getElementById('editModal');
const editModal = new bootstrap.Modal(editModalEl);

// load from localStorage
function loadEntries(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    entries = raw ? JSON.parse(raw) : [];
  } catch(e) {
    console.error('Failed to parse storage', e);
    entries = [];
  }
}

function saveEntries(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
}

function renderTable(){
  entriesTableBody.innerHTML = '';
  if(entries.length === 0){
    noData.style.display = 'block';
    document.getElementById('entriesTable').style.display = 'none';
    return;
  }
  noData.style.display = 'none';
  document.getElementById('entriesTable').style.display = '';

  entries.forEach((e, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${escapeHtml(e.name)}</td>
      <td>${escapeHtml(e.email)}</td>
      <td>${escapeHtml(e.phone||'')}</td>
      <td>${escapeHtml(e.course||'')}</td>
      <td class="text-truncate" style="max-width:200px">${escapeHtml(e.notes||'')}</td>
      <td>
        <button class="btn btn-sm btn-outline-primary me-1" data-id="${e.id}" onclick="onEdit('${e.id}')">Edit</button>
        <button class="btn btn-sm btn-outline-danger" data-id="${e.id}" onclick="onDelete('${e.id}')">Delete</button>
      </td>
    `;
    entriesTableBody.appendChild(tr);
  });
}

// utility to avoid HTML injection in table
function escapeHtml(s){
  if(!s) return '';
  return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#039;");
}

// Add new entry
regForm.addEventListener('submit', function(e){
  e.preventDefault();
  // simple validation
  if(!regForm.checkValidity()){
    regForm.classList.add('was-validated');
    return;
  }

  const data = {
    id: generateId(),
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    course: document.getElementById('course').value,
    notes: document.getElementById('notes').value.trim(),
    createdAt: new Date().toISOString()
  };
  entries.push(data);
  saveEntries();
  renderTable();
  regForm.reset();
  regForm.classList.remove('was-validated');
});

// Reset button
document.getElementById('resetBtn').addEventListener('click', ()=>{ regForm.reset(); regForm.classList.remove('was-validated'); });

// Download JSON
downloadBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(entries, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'registrations.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

// Import JSON
importFile.addEventListener('change', (ev)=>{
  const file = ev.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try{
      const parsed = JSON.parse(e.target.result);
      if(!Array.isArray(parsed)) throw new Error('JSON must be an array of entries');
      // normalize entries if needed (add id if missing)
      parsed.forEach(p => { if(!p.id) p.id = generateId(); });
      // merge - keep existing and append new ones
      entries = entries.concat(parsed);
      saveEntries();
      renderTable();
      importFile.value = '';
      alert('Imported ' + parsed.length + ' entries.');
    }catch(err){
      alert('Failed to import: ' + err.message);
    }
  }
  reader.readAsText(file);
});

// Clear all
document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('Clear ALL entries? This cannot be undone.')) return;
  entries = [];
  saveEntries();
  renderTable();
});

// Edit handlers (exposed on window so buttons inline onclick can call)
window.onEdit = function(id){
  const item = entries.find(x=>x.id===id);
  if(!item) return alert('Item not found');
  document.getElementById('editId').value = item.id;
  document.getElementById('editName').value = item.name;
  document.getElementById('editEmail').value = item.email;
  document.getElementById('editPhone').value = item.phone||'';
  document.getElementById('editCourse').value = item.course||'';
  document.getElementById('editNotes').value = item.notes||'';
  editModal.show();
}

window.onDelete = function(id){
  if(!confirm('Delete this entry?')) return;
  entries = entries.filter(x=>x.id!==id);
  saveEntries();
  renderTable();
}

// Save edit
document.getElementById('saveEdit').addEventListener('click', ()=>{
  const id = document.getElementById('editId').value;
  const i = entries.findIndex(x=>x.id===id);
  if(i===-1) return alert('Entry not found');
  // basic validation
  const name = document.getElementById('editName').value.trim();
  const email = document.getElementById('editEmail').value.trim();
  if(!name || !email){
    alert('Name and email are required');
    return;
  }
  entries[i].name = name;
  entries[i].email = email;
  entries[i].phone = document.getElementById('editPhone').value.trim();
  entries[i].course = document.getElementById('editCourse').value.trim();
  entries[i].notes = document.getElementById('editNotes').value.trim();
  entries[i].updatedAt = new Date().toISOString();
  saveEntries();
  renderTable();
  editModal.hide();
});

function generateId(){
  return 'id_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2,8);
}

// initialize
loadEntries();
renderTable();
</script>
<h3>for Registration Form</h3>
<a href="round3.html">CLICK HERE!</a>
</body>
</html>
